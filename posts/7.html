<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>@jiwon.blog</title>
	<link rel="icon" type="image/png" href="../favicon.ico">
	<link rel="stylesheet" href="../index.css" />
	<noscript><div id="noscript" class="display-flex">Your browser does not support JavaScript!</div></noscript>
</head>
<body>
	<div id="wrap" class="margin-0-auto position-relative">
		<div id="content">
            <div class="title">LAMP 및 SSL 기본 설정</div>
            <div class="info">2021. 01. 20 by Jiwon Min</br>Wed Jan 20 2021 (Korea Standard Time)</div>

            <div class="explain">
				
<h3>디스크 스왑</h3>
낮은 사양의 컴퓨팅 리소스 사용 시, 디스크 스왑 기능의 사용이 필요합니다.<br/><br/>

<pre>
/* 스왑 파일/파티션 존재 여부 확인 */
<code>$ sudo free -m</code>

/* swap 설정이 되어있는지 확인 */
<code>$ sudo swapon -s</code>

/* 스왑 파일(swapfile) 생성 */
<code>$ sudo fallocate -l 2G /swapfile</code>

/* 파일의 권한을 수정 */
<code>$ sudo chmod 600 /swapfile</code>

/* 해당 파일이 스왑으로 동작하도록 설정 */
<code>$ sudo mkswap /swapfile</code>

/* 스왑 활성화 */
<code>$ sudo swapon /swapfile</code>

/* 재부팅 후에도 스왑 활성화되도록 설정 */
<code>$ sudo vim /etc/fstab</code>
/* 파일 하단에 아래 내용 추가 */
<code>/swapfile swap swap defaults 0 0</code>
</pre>

<h3>Apache 설치 및 설정</h3>

<pre>
/* 설치 */
<code>$ apt install apache2</code>

/* SSL 인증서 관련 패키지 설치 및 기본 설정 */
<code>$ apt install ssl-cert</code>
<code>$ apt install certbot</code>
<code>$ a2enmod rewrite</code>
<code>$ a2enmod headers</code>
<code>$ a2enmod ssl</code>
<code>$ a2dismod -f autoindex</code>

/* 개별 권한 설정 */
<code>$ apt-cache search mpm-itk</code>
<code>$ apt install libapache2-mpm-itk</code>
<code>$ chmod 711 /home</code>
<code>$ chmod -R 700 /home/*</code>

/* 변경사항 적용 후 문법검사 */
<code>$ service apache2 restart</code>
<code>$ apache2ctl -S</code>

/* Charset, TimeZone, Security 추가 설정 */
<code>$ vi /etc/apache2/conf-available/charset.conf</code> # AddDefaultCharset UTF-8 주석 제거
<code>$ vi /etc/apache2/conf-available/security.conf</code> # ServerSignature Off 등 주석 제거
<code>$ vi /etc/apache2/apache2.conf</code> # .git, .env 등 추가 보안 필요한 파일 설정
</pre>


<h3>PHP 설치 및 설정</h3>

<pre>
/* 설치 */
<code>$ apt install php</code>

/* 관련 모듈 설치 */
<code>$ apt install php-mysql</code> # mysql 연동 시 필요
<code>$ apt-cache search php- | grep ^php- | grep module</code> # 필요한 패키지 검색

/* TimeZone, Security 추가 설정 */
<code>$ vi /etc/php/7.2/apache2/php.ini</code>
<code>$ vi /etc/php/7.2/cli/php.ini</code>
<code>date.timezone = Asia/Seoul</code> # /timezone 입력으로 검색 후 설정
</pre>


<h3>MySQL 설치 및 설정</h3>
<pre>
/* 설치 */
<code>$ apt install mysql-server</code>

/* 계정 설정 */
<code>$ mysql_secure_installation</code>
# 모두 y 입력하고, 'password strength' 값은 0 으로 설정
# 잘못 입력 했을 경우, 다시 실행

/* Charset 확인 */
<code>$ mysqladmin variables | grep character</code>

/* 사용자 확인 */
<code>SELECT user,authentication_string,plugin,host FROM mysql.user;</code>

<code>root.plugin = 'auth_socket'</code> 
# root 계정은 auth_socket 으로 설정되어 있어서 패스워드 로그인 불가능
# 로그인 시, `sudo mysql` 으로만 로그인 가능

/* 사용자 추가 */
<code>CREATE user 'ID'@'HOST' IDENTIFIED BY 'PASSWORD';</code>

/* 권한 확인 및 추가 */
<code>SHOW GRANTS FOR 'ID'@'HOST';</code>
<code>GRANT SELECT, INSERT, UPDATE, DELETE ON dbname.* TO 'ID'@'HOST';</code>
</pre>




<h3>SSL 설정</h3>

<pre>
# 아래의 링크를 클릭해서 환경설정 파일을 생성하세요.
# Apache2 환경설정 생성기
<a href="https://webmaster.cafe/tools/apache-conf-generator/" title="Apache2 환경설정 생성기" target="_blank">https://webmaster.cafe/tools/apache-conf-generator/</a>

/* 사이트 켜기 */
<code>$ a2ensite jiwon.blog</code>

/* 사이트 끄기 */
<code>$ a2dissite jiwon.blog</code>

/* 변경사항 적용 */
<code>$ service apache2 reload</code>

/* LetsEncrypt 인증서 발급 */
# 발급에 실패하는 경우, http 접근 허용 확인 필요
<code>$ certbot certonly --webroot --webroot-path=/var/www/jiwon.blog -d jiwon.blog</code>
</pre>



<h3>Lect's Encrypt SSL 인증서 자동 갱신</h3>
<pre>
/* 리눅스 스케쥴러 패키지 설치 */
<code>$ apt install cron</code>

/* Crontab 등록 */
<code>$ sudo crontab -e</code>

# 매월 1일 03시 인증서 갱신 후 웹서버 reload
<code>0 3 1 * * certbot renew --renew-hook="service apache2 reload"</code>

/* Crontab 실행 로그 확인 */
<code>$ view /var/log/syslog</code>

/* 인증서 만료일 확인 */
<code>$ certbot certificates</code>

/* 현재 서버에서 사용중인 인증서 목록 보기 */
<code>$ sudo ls /etc/letsencrypt/live/</code>
</pre>

            </div>
		</div>
	</div>

    <script src="../index.js" type="text/javascript"></script>
</body>
</html>