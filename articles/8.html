<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>DESSIN.DEV</title>

	<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="192x192" href="../favicon-192x192.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
	<link rel="icon" type="image/png" href="../favicon.ico">

	<link rel="stylesheet" href="../index.css" />

	<noscript><div id="noscript">Your browser does not support JavaScript!</div></noscript>
</head>
<body>
	<div id="wrap">
		<div id="header" onclick="scollTop()">
			<div class="header-wrap">
				<div class="menu" onclick="openMenu()">
					<div class="line"></div>
					<div class="line"></div>
					<div class="line"></div>
				</div>
				<div class="title" onclick="goHomepage()">DESSIN</div>
				<div class="empty-space"></div>
			</div>
		</div>

		<div id="content">
            <div class="title">간단한 LAMP 서버 세팅 (Ubuntu, Apache, MySQL, PHP)</div>
            <div class="datetime">2020년 11월 06일</div>

            <div class="explain">

				<!-- TODO: 내용 입력-->

				1. 낮은 사양의 리눅스 사용 시

				메모리가 부족한 경우, 작업 중인 일부 내용을 디스크로 스왑(Swap)하게 됩니다.
				1-1. 스왑 파일/파티션 존재 여부 확인
				<pre>
					sudo free -m
				</pre>

				1-2. swap 설정이 되어있는지 확인
				<pre>
					sudo swapon -s
				</pre>

				1-3. 스왑 파일(swapfile) 생성
				스왑 용도로 사용할 파일을 swapfile 이라는 이름으로 생성합니다.
				아래 명령어는 2GB의 용량으로 생성합니다.
				<pre>
					sudo fallocate -l 2G /swapfile
				</pre>

				파일의 권한을 수정합니다.
				<pre>
					sudo chmod 600 /swapfile
				</pre>

				1.4 스왑을 활성화시킵니다.
				<pre>
					sudo swapon /swapfile
				</pre>

				1.5 재부팅 이후에도 계속 사용하려면 아래 내용을 등록합니다.
				<pre>
					sudo vim /etc/fstab

					# 파일 하단에 아래 내용을 추가합니다.
					/swapfile swap swap defaults 0 0
				</pre>


				리눅스 timzeone 설정
				sudo dpkg-reconfigure tzdata

				필요한 패키지 다운로드
				apt install vim
				apt install git

				-----------------------------------------------------


				
				우분투 패키지 검색
				https://packages.ubuntu.com/

				1. apache 설치
				apt install apache2

				1-1. https 인증서 관련 패키지 설치 및 apache2 기본 설정
				<pre>
					# apt install ssl-cert
					# apt install certbot
					# a2enmod rewrite
					# a2enmod headers
					# a2enmod ssl
					# a2dismod -f autoindex
				</pre>

				Apache 개별 권한 설정
				<pre>
					apt-cache search mpm-itk

					apt install libapache2-mpm-itk
					chmod 711 /home
					chmod -R 700 /home/*
				</pre>

				변경사항 적용 후 문법검사
				<pre>
					service apache2 restart
					apache2ctl -S
				</pre>

				1-2. apache2 charset, timezone, security 추가 설정

				<pre>
					# AddDefaultCharset UTF-8 주석 제거
					vi /etc/apache2/conf-available/charset.conf

					# ServerSignature Off 등 주석 제거
					vi /etc/apache2/conf-available/security.conf

					# .git, .env 등 추가 보안 필요한 파일 설정
					vi /etc/apache2/apache2.conf
				</pre>





				-----------------------------------------------------





				2. php 설치 
				apt install php
				
				1-1. php 관련 모듈 설치
				<pre>
					# mysql 연동 시 필요
					apt install php-mysql

					# 필요한 패키지 검색
					apt-cache search php- | grep ^php- | grep module
				</pre>

				1-3. timezone, security 추가 설정
				<pre>
					vi /etc/php/7.2/apache2/php.ini
					vi /etc/php/7.2/cli/php.ini

					# /timezone 입력으로 검색 후 설정
					date.timezone = Asia/Seoul
				</pre>





				-----------------------------------------------------



				3. mysql 설치
				apt install mysql-server

				1-1. mysql_secure_installation 실행
				모두 y 입력하고, password strength 는 0 으로 설정
				잘못 입력 했을 경우, 한번 더 실행

				mysql charset 확인
				<pre>
					mysqladmin variables | grep character
				</pre>

				mysql user 확인
				<pre>
					SELECT user,authentication_string,plugin,host FROM mysql.user;

					# root 계정은 auth_socket 으로 설정되어 있어서 패스워드 로그인 불가능
					root.plugin = 'auth_socket'

					로그인 시에 `sudo mysql` 으로만 로그인 가능
				</pre>

				mysql 새로운 사용자 추가
				<pre>
					CREATE user 'ID'@'HOST' IDENTIFIED BY 'PASSWORD';

					권한 확인 후 추가
					SHOW GRANTS FOR 'ID'@'HOST';
					GRANT SELECT, INSERT, UPDATE, DELETE ON dbname.* TO 'ID'@'HOST';
				</pre>



				-----------------------------------------------------


				4. https 설정

				아래의 링크를 클릭해서 환경설정 파일을 생성하세요.
				<pre>
					Apache2 환경설정 생성기
					https://webmaster.cafe/tools/apache-conf-generator/
				</pre>

				사이트 켜기
				<pre>
					a2ensite lab.dessin.dev
				</pre>

				사이트 끄기
				<pre>
					a2dissite lab.dessin.dev
				</pre>

				변경사항 적용
				<pre>
					service apache2 reload
				</pre>

				LetsEncrypt 인증서 발급
				<pre>
					certbot certonly --webroot --webroot-path=/var/www/lab.dessin.dev -d lab.dessin.dev
					# 발급에 실패하는 경우, http 접근 허용 확인 필요
				</pre>


				-----------------------------------------------------


				5. Lect's Encrypt SSL 인증서 자동 갱신

				리눅스 스케쥴러 패키지 설치
				<pre>
					apt install cron
				</pre>

				Crontab 등록
				<pre>
					sudo crontab -e

					# 매월 1일 03시 인증서 갱신 후 웹서버 reload
					0 3 1 * * certbot renew --renew-hook="service apache2 reload"
				</pre>

				Crontab 실행 로그
				<pre>
					view /var/log/syslog
				</pre>

				인증서 만료일 확인
				<pre>
					certbot certificates
				</pre>

				현재 서버에서 사용중인 인증서 목록 보기
				<pre>
					sudo ls /etc/letsencrypt/live/
				</pre>






				# GCP 무료 인스턴스
				f1-micro(vCPU 1개, 0.6GB 메모리)
				us-central1-a
				30GB

				# LAMP 설치
				https://blog.lael.be/post/7264

				# MYSQL 비밀번호 설정
				https://alllman.com/%EC%9A%B0%EB%B6%84%ED%88%ACubuntu-19-10%EC%97%90-lampapache2-mysql-php7%EC%99%80-phpmyadmin%EC%9D%84-%EC%84%A4%EC%B9%98%ED%95%B4%EB%B3%B4%EC%9E%90/

				# php 로 mysql 연결확인
				https://www.deok.me/entry/Ubuntu-1604-%EC%97%90%EC%84%9C-APM-%EC%84%A4%EC%B9%98-%ED%95%98%EA%B8%B0-Apache2-PHP-Mysql-or-MariaDB

            </div>

			<div id="footer">
				<div class="rights">&copy; 2020 Jiwon Min. All rights reserved.</div>
				<div class="design">Designed by Jiwon Min.</div>
			</div>
		</div>
	</div>

    <script src="../index.js" type="text/javascript"></script>
</body>
</html>