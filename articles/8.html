<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>DESSIN.DEV</title>

	<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="192x192" href="../favicon-192x192.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
	<link rel="icon" type="image/png" href="../favicon.ico">

	<link rel="stylesheet" href="../index.css" />

	<noscript><div id="noscript">Your browser does not support JavaScript!</div></noscript>
</head>
<body>
	<div id="wrap">
		<div id="header" onclick="scrollToHeader()">
			<div class="header-wrap">
				<div class="menu" onclick="openMenu()">
					<div class="line"></div>
					<div class="line"></div>
					<div class="line"></div>
				</div>
				<div class="title" onclick="goHomepage()">DESSIN</div>
				<div class="search-articles"></div>
			</div>
		</div>

		<div id="content">
            <div class="title">LAMP</div>
            <div class="datetime">2020년 11월 06일</div>

            <div class="explain">
				<p>
					낮은 사양의 리눅스 사용 시, 메모리가 부족한 경우, 작업 중인 일부 내용을 디스크로 스왑(Swap)하게 됩니다.
				</p>

				<h1>스왑 파일/파티션 존재 여부 확인</h1>

				<pre>
					sudo free -m
				</pre>

				<h1>swap 설정이 되어있는지 확인</h1>

				<pre>
					sudo swapon -s
				</pre>

				<h1>스왑 파일(swapfile) 생성</h1>

				<p>
					스왑 용도로 사용할 파일을 swapfile 이라는 이름으로 생성합니다.
					아래 명령어는 2GB의 용량으로 생성합니다.
				</p>
				
				<pre>
					sudo fallocate -l 2G /swapfile
				</pre>

				<p>
					파일의 권한을 수정합니다.
				</p>

				<pre>
					sudo chmod 600 /swapfile
				</pre>

				<h1>스왑 활성화</h1>

				<pre>
					sudo swapon /swapfile
				</pre>

				<p>
					재부팅 이후에도 계속 사용하려면 아래 내용을 등록합니다.
				</p>

				<pre>
					sudo vim /etc/fstab

					# 파일 하단에 아래 내용을 추가합니다.
					/swapfile swap swap defaults 0 0
				</pre>

				<p>
					리눅스 timzeone 설정
				</p>

				<pre>
					sudo dpkg-reconfigure tzdata
				</pre>

				<p>
					필요한 패키지 다운로드
				</p>

				<pre>
					apt install vim
					apt install git
				</pre>


				<hr/>
				

				<h1>우분투 패키지 검색</h1>

				<ul>
					<li>https://packages.ubuntu.com/</li>
				</ul>

				<h1>1. apache 설치</h1>

				<pre>
					apt install apache2
				</pre>

				<h1>https 인증서 관련 패키지 설치 및 apache2 기본 설정</h1>

				<pre>
					# apt install ssl-cert
					# apt install certbot
					# a2enmod rewrite
					# a2enmod headers
					# a2enmod ssl
					# a2dismod -f autoindex
				</pre>

				<h1>Apache 개별 권한 설정</h1>

				<pre>
					apt-cache search mpm-itk

					apt install libapache2-mpm-itk
					chmod 711 /home
					chmod -R 700 /home/*
				</pre>

				<h1>변경사항 적용 후 문법검사</h1>

				<pre>
					service apache2 restart
					apache2ctl -S
				</pre>

				<h1>apache2 charset, timezone, security 추가 설정</h1>

				<pre>
					# AddDefaultCharset UTF-8 주석 제거
					vi /etc/apache2/conf-available/charset.conf

					# ServerSignature Off 등 주석 제거
					vi /etc/apache2/conf-available/security.conf

					# .git, .env 등 추가 보안 필요한 파일 설정
					vi /etc/apache2/apache2.conf
				</pre>


				<hr/>


				<h1>2. php 설치 </h1>

				<pre>
					apt install php
				</pre>
				
				<h1>php 관련 모듈 설치</h1>

				<pre>
					# mysql 연동 시 필요
					apt install php-mysql

					# 필요한 패키지 검색
					apt-cache search php- | grep ^php- | grep module
				</pre>

				<h1>timezone, security 추가 설정</h1>

				<pre>
					vi /etc/php/7.2/apache2/php.ini
					vi /etc/php/7.2/cli/php.ini

					# /timezone 입력으로 검색 후 설정
					date.timezone = Asia/Seoul
				</pre>
				

				<hr/>


				<h1>3. mysql 설치</h1>

				<pre>
					apt install mysql-server
				</pre>

				<h1>mysql_secure_installation 실행</h1>

				<p>
					모두 y 입력하고, password strength 는 0 으로 설정
					잘못 입력 했을 경우, 한번 더 실행
				</p>

				<h1>mysql charset 확인</h1>

				<pre>
					mysqladmin variables | grep character
				</pre>

				<h1>mysql user 확인</h1>

				<pre>
					SELECT user,authentication_string,plugin,host FROM mysql.user;

					# root 계정은 auth_socket 으로 설정되어 있어서 패스워드 로그인 불가능
					root.plugin = 'auth_socket'

					로그인 시에 `sudo mysql` 으로만 로그인 가능
				</pre>

				<h1>mysql 새로운 사용자 추가</h1>

				<pre>
					CREATE user 'ID'@'HOST' IDENTIFIED BY 'PASSWORD';

					권한 확인 후 추가
					SHOW GRANTS FOR 'ID'@'HOST';
					GRANT SELECT, INSERT, UPDATE, DELETE ON dbname.* TO 'ID'@'HOST';
				</pre>
				

				<hr/>


				<h1>4. https 설정</h1>

				<p>
					아래의 링크를 클릭해서 환경설정 파일을 생성하세요.
				</p>

				<pre>
					Apache2 환경설정 생성기
					<a href="https://webmaster.cafe/tools/apache-conf-generator/" title="Apache2 환경설정 생성기" target="_blank">https://webmaster.cafe/tools/apache-conf-generator/</a>
				</pre>

				<h1>사이트 켜기</h1>

				<pre>
					a2ensite lab.dessin.dev
				</pre>

				<h1>사이트 끄기</h1>

				<pre>
					a2dissite lab.dessin.dev
				</pre>

				<h1>변경사항 적용</h1>

				<pre>
					service apache2 reload
				</pre>

				<h1>LetsEncrypt 인증서 발급</h1>

				<pre>
					certbot certonly --webroot --webroot-path=/var/www/lab.dessin.dev -d lab.dessin.dev
					# 발급에 실패하는 경우, http 접근 허용 확인 필요
				</pre>
				

				<hr/>


				<h1>5. Lect's Encrypt SSL 인증서 자동 갱신</h1>

				<h1>리눅스 스케쥴러 패키지 설치</h1>

				<pre>
					apt install cron
				</pre>

				<h1>Crontab 등록</h1>

				<pre>
					sudo crontab -e

					# 매월 1일 03시 인증서 갱신 후 웹서버 reload
					0 3 1 * * certbot renew --renew-hook="service apache2 reload"
				</pre>

				<h1>Crontab 실행 로그</h1>

				<pre>
					view /var/log/syslog
				</pre>

				<h1>인증서 만료일 확인</h1>

				<pre>
					certbot certificates
				</pre>

				<h1>현재 서버에서 사용중인 인증서 목록 보기</h1>

				<pre>
					sudo ls /etc/letsencrypt/live/
				</pre>
				
            </div>

			<div id="footer">
				<div class="rights">&copy; 2020 Jiwon Min. All rights reserved.</div>
				<div class="design">Designed by Jiwon Min.</div>
			</div>
		</div>
	</div>

    <script src="../index.js" type="text/javascript"></script>
</body>
</html>